{
	"name": "detect-conflicts",
	"description": "Automatically detects and resolves merge conflicts with base branch before pushing",
	"hooks": [
		{
			"event": "PreToolUse",
			"matcher": {
				"tool": "Bash",
				"command": "git push"
			},
			"prompt": "Before pushing, check if this branch has merge conflicts with its base branch and automatically resolve them.\n\n## Steps\n\n1. Get the current branch name:\n   ```bash\n   git branch --show-current\n   ```\n\n2. Determine the base branch (usually main or master):\n   ```bash\n   git remote show origin | grep 'HEAD branch' | cut -d' ' -f5\n   ```\n\n3. Fetch latest from remote:\n   ```bash\n   git fetch origin\n   ```\n\n4. Check if there would be conflicts by attempting a merge:\n   ```bash\n   git merge --no-commit --no-ff origin/<base> 2>&1\n   ```\n\n5. If conflicts are detected, resolve them automatically:\n   - For each conflicted file, read and analyze the conflicts\n   - Auto-resolve using these strategies:\n     - **Import conflicts**: Merge both import sets, deduplicate, sort\n     - **Whitespace/formatting**: Take the better formatted version\n     - **Non-overlapping additions**: Keep both in logical order\n     - **Deleted vs unchanged**: Take the deletion\n     - **Both modified same logic**: Analyze intent from commit messages and code context, choose the most complete/correct version\n   - Edit each file to remove conflict markers with the resolved content\n   - Stage resolved files: `git add <file>`\n   - Verify no conflict markers remain:\n     ```bash\n     grep -r \"<<<<<<<\" . --include=\"*.ts\" --include=\"*.js\" --include=\"*.tsx\" --include=\"*.jsx\" --include=\"*.json\" 2>/dev/null\n     ```\n   - Complete the merge:\n     ```bash\n     git commit -m \"merge: resolve conflicts with <base>\"\n     ```\n   - Inform the user what was resolved (brief summary)\n\n6. If merge started but no conflicts:\n   ```bash\n   git commit -m \"merge: sync with <base>\"\n   ```\n\n7. If already up to date or no conflicts detected:\n   - Allow the push to proceed without interruption\n   - Do NOT output anything - stay silent\n\n## Resolution Guidelines\n\nWhen resolving conflicts, prefer:\n- The version with more complete functionality\n- The version that matches the project's existing patterns\n- The incoming (base branch) version for shared utilities/types that others depend on\n- The current branch version for feature-specific code\n\n## Important\n\n- Be fully automatic - do not ask the user for input\n- Only inform the user what was resolved after the fact\n- Be silent when no conflicts exist\n- If resolution fails for any reason, abort the merge and let the push proceed (conflicts will show on PR)"
		}
	]
}
